# kOS Chart Library

A library for drawing charts in the kOS terminal using Braille characters. It allows for a "virtual" resolution of 2x4 pixels per terminal character, enabling the creation of readable real-time charts.

## Features

*   **High Resolution:** Uses Unicode Braille characters to pack 8 pixels into a single terminal character (2x4 grid).
*   **Chart Drawing:** Easily create line or scatter plots.
*   **Automatic Axes:** Draws X and Y axes with labels and ticks.
*   **Paging:** Automatic handling of data exceeding the X or Y axis range (paging).
*   **High Performance:** 
    *   **Fast Initialization:** Uses static Look-Up Tables (LUTs) and `SUBLIST` for near-instant chart creation (0.4s vs 17s for 50 charts).
    *   **Optimized Rendering:** Uses dirty-row tracking to only redraw changed parts of the screen.
    *   **Inlined Math:** Critical drawing functions use inlined Bresenham's algorithm and integer math for maximum speed.

## Benchmarking

The library includes a `benchmark.ks` script to test performance on your machine.

```kos
RUNPATH("0:/benchmark.ks").
```

The benchmark tests:
1.  **Initialization:** Creating multiple chart instances.
2.  **Plotting:** Calculating and setting pixels for thousands of points.
3.  **Rendering:** Refresh rate of the terminal output.
4.  **Paging:** Performance of clearing and redrawing axes when the chart scrolls.

## Font Configuration

**Important:** To display the charts correctly, you must change the kOS terminal font to one that supports Braille characters (e.g., **Cascadia Code**).

1.  Open the kOS App Control Panel in-game.
2.  Go to Settings / Terminal Font.
3.  Select **Cascadia Code** or another font with Braille support.

## Installation

Place the `canvas.ks` and `chart.ks` files in your `Ships/Script` folder (the Archive `0:/`).
Optionally, include `example.ks` and `benchmark.ks` for testing.



## Usage

### 1. Import libraries

You must run the library files to load the functions into memory. Ensure `canvas.ks` is loaded before creating a chart.

```kos
// Run from Archive
RUNPATH("0:/chart.ks").
```

### 2. Chart Initialization

The `Chart` function accepts the following parameters:
*   `width`, `height`: Dimensions in "pixels" (not characters!).
*   `originX`, `originY`: Top-left corner position in the terminal (in characters).
*   `minX`, `maxX`: X-axis range.
*   `minY`, `maxY`: Y-axis range.
*   `title`: Chart title (optional, default "").
*   `plotMode`: "LINE" (continuous line) or "POINT" (points) (optional, default "LINE").
*   `enablePaging`: Boolean to enable/disable automatic paging when X exceeds range (optional, default TRUE).

```kos
// Example: 100x100 pixel chart
GLOBAL myChart IS Chart(
    100, 100,           // Dimensions (px)
    2, 2,               // Position (chars)
    0, 100,             // X Range
    -10, 10,            // Y Range
    "Test Chart",       // Title
    "LINE"              // Mode
).
```

### 3. Drawing Axes

```kos
// drawAxes(stepX, stepY, scaleX, scaleY, clearOnly)
// scaleX/Y: Divisor for labels (default 1)
// clearOnly: If TRUE, clears the axes instead of drawing (default FALSE)
myChart["drawAxes"](10, 2). 
```

### 4. Adding Data

In the main program loop, add points using the `plot(x, y, autoDraw)` method.

*   `x`, `y`: Coordinates to plot.
*   `autoDraw`: If TRUE, calls `draw()` immediately after plotting (default TRUE). Set to FALSE for batch plotting.

```kos
UNTIL FALSE {
    myChart["plot"](TIME:SECONDS, SHIP:ALTITUDE).
    WAIT 0.1.
}
```

### 5. Manual Drawing

The `draw(force)` method renders the chart to the terminal.
*   `force`: If TRUE, redraws all characters even if they haven't changed (default FALSE).

```kos
myChart["draw"](TRUE). // Force full redraw
```

## Example

A full example can be found in the `example.ks` file.

```kos
// Fragment of example.ks
SET TERMINAL:WIDTH TO 60.
SET TERMINAL:HEIGHT TO 40.
CLEARSCREEN.

RUNPATH("0:/canvas.ks").
RUNPATH("0:/chart.ks").

GLOBAL myChart IS Chart(100, 100, 5, 5, 0, 100, -1, 1, "Sine Wave", "LINE").
myChart["drawAxes"](10, 0.5). 
myChart["draw"](TRUE).

LOCAL t0 IS TIME:SECONDS.
UNTIL FALSE {
    LOCAL dt IS TIME:SECONDS - t0.
    myChart["plot"](dt, SIN(dt * 10)).
    WAIT 0.05.
}
```

## Gallery

### Sine Wave Chart
![Sine Wave](screenshots/screen1.png)

*Description: Example sine function chart generated by example.ks*

### 8 Charts
![Altitude](screenshots/screen2.png)
*Description:*

### Graphics
![Graphics](screenshots/248x420bmp.png)

---
